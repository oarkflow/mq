{
    "app": {
        "name": "Email Campaign Manager",
        "version": "1.0.0",
        "description": "Complete email campaign application built from JSON configuration",
        "port": "3000",
        "host": "localhost"
    },
    "data": {
        "app_title": "üìß Email Campaign Manager",
        "users": [
            { "username": "admin", "password": "admin123", "role": "admin" },
            { "username": "marketer", "password": "marketer123", "role": "marketer" },
            { "username": "viewer", "password": "viewer123", "role": "viewer" }
        ],
        "email_providers": [
            {
                "id": "sendgrid",
                "name": "SendGrid",
                "type": "api",
                "endpoint": "https://api.sendgrid.com/v3/mail/send",
                "cost_per_email": 0.001,
                "features": [ "templates", "analytics", "delivery_tracking" ],
                "limits": { "daily": 100000, "monthly": 3000000 }
            },
            {
                "id": "mailgun",
                "name": "Mailgun",
                "type": "api",
                "endpoint": "https://api.mailgun.net/v3/mg.example.com/messages",
                "cost_per_email": 0.0008,
                "features": [ "templates", "tracking", "validation" ],
                "limits": { "daily": 50000, "monthly": 1500000 }
            },
            {
                "id": "aws_ses",
                "name": "Amazon SES",
                "type": "api",
                "endpoint": "https://email.us-east-1.amazonaws.com",
                "cost_per_email": 0.0001,
                "features": [ "bulk_sending", "bounce_handling" ],
                "limits": { "daily": 200, "monthly": 6000 }
            }
        ],
        "email_templates": [
            {
                "id": "welcome",
                "name": "Welcome Email",
                "subject": "Welcome to {{.company}}!",
                "html_content": "<h1>Welcome {{.name}}!</h1><p>Thank you for joining us.</p>",
                "text_content": "Welcome {{.name}}! Thank you for joining us."
            },
            {
                "id": "newsletter",
                "name": "Monthly Newsletter",
                "subject": "{{.company}} Monthly Newsletter - {{.month}}",
                "html_content": "<h1>Newsletter</h1><p>Here's what's new this month...</p>",
                "text_content": "Newsletter: Here's what's new this month..."
            },
            {
                "id": "promotion",
                "name": "Promotional Email",
                "subject": "Special Offer: {{.discount}}% Off!",
                "html_content": "<h1>{{.discount}}% Off!</h1><p>Limited time offer!</p>",
                "text_content": "{{.discount}}% Off! Limited time offer!"
            }
        ],
        "recipient_lists": [
            {
                "id": "customers",
                "name": "All Customers",
                "contacts": [
                    { "email": "customer1@example.com", "name": "John Doe", "tags": [ "vip", "newsletter" ] },
                    { "email": "customer2@example.com", "name": "Jane Smith", "tags": [ "newsletter" ] },
                    { "email": "customer3@example.com", "name": "Bob Johnson", "tags": [ "promotions" ] }
                ]
            },
            {
                "id": "prospects",
                "name": "Prospects",
                "contacts": [
                    { "email": "prospect1@example.com", "name": "Alice Brown", "tags": [ "trial" ] },
                    { "email": "prospect2@example.com", "name": "Charlie Davis", "tags": [ "demo" ] }
                ]
            }
        ]
    },
    "middleware": [
        {
            "id": "logging",
            "name": "Request Logging",
            "type": "logging",
            "priority": 1,
            "enabled": true,
            "config": { }
        },
        {
            "id": "auth",
            "name": "Authentication",
            "type": "auth",
            "priority": 2,
            "enabled": true,
            "config": {
                "skip_paths": [ "/", "/login", "/docs" ]
            }
        }
    ],
    "templates": {
        "login_page": {
            "type": "html",
            "template": "<!DOCTYPE html>\n<html>\n<head>\n    <title>{{.app_title}} - Login</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 500px; margin: 100px auto; padding: 20px; background: #f5f5f5; }\n        .login-container { padding: 40px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background: white; }\n        .form-group { margin-bottom: 20px; }\n        label { display: block; margin-bottom: 5px; font-weight: bold; }\n        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }\n        button { width: 100%; background: #007bff; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }\n        button:hover { background: #0056b3; }\n        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 4px; margin-top: 10px; }\n        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 10px; border-radius: 4px; margin-top: 10px; }\n    </style>\n</head>\n<body>\n    <div class=\"login-container\">\n        <h1>üîê Email Campaign Login</h1>\n        <div style=\"background: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px;\">\n            <h3>Demo Users:</h3>\n            {{range .users}}\n            <p><strong>{{.username}}</strong> / {{.password}} ({{.role}})</p>\n            {{end}}\n        </div>\n        <form id=\"loginForm\">\n            <div class=\"form-group\">\n                <label for=\"username\">Username:</label>\n                <input type=\"text\" id=\"username\" name=\"username\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"password\">Password:</label>\n                <input type=\"password\" id=\"password\" name=\"password\" required>\n            </div>\n            <button type=\"submit\">Login</button>\n        </form>\n        <div id=\"result\"></div>\n    </div>\n    <script>\n        document.getElementById('loginForm').addEventListener('submit', async function(e) {\n            e.preventDefault();\n            const username = document.getElementById('username').value;\n            const password = document.getElementById('password').value;\n            const resultDiv = document.getElementById('result');\n            try {\n                const response = await fetch('/auth/login', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ username, password })\n                });\n                const result = await response.json();\n                if (result.success) {\n                    resultDiv.innerHTML = '<div class=\"success\">‚úÖ Login successful! Redirecting...</div>';\n                    sessionStorage.setItem('authToken', result.token);\n                    sessionStorage.setItem('user', JSON.stringify(result.user));\n                    setTimeout(() => { window.location.href = '/campaigns'; }, 1000);\n                } else {\n                    resultDiv.innerHTML = '<div class=\"error\">‚ùå ' + result.error + '</div>';\n                }\n            } catch (error) {\n                resultDiv.innerHTML = '<div class=\"error\">‚ùå ' + error.message + '</div>';\n            }\n        });\n    </script>\n</body>\n</html>"
        },
        "campaign_dashboard": {
            "type": "html",
            "template": "<!DOCTYPE html>\n<html>\n<head>\n    <title>{{.app_title}}</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }\n        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; }\n        .user-info { font-size: 14px; color: #666; }\n        .logout-btn { background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }\n        .step { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }\n        .step.active { border-color: #007bff; background: #f8f9ff; }\n        .step-header { display: flex; align-items: center; margin-bottom: 15px; }\n        .step-number { background: #007bff; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }\n        .form-group { margin-bottom: 15px; }\n        label { display: block; margin-bottom: 5px; font-weight: bold; }\n        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }\n        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }\n        button.send { background: #28a745; }\n        .provider-option { display: flex; align-items: center; margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }\n        .provider-option:hover { background: #f8f9fa; }\n        .provider-option.selected { border-color: #007bff; background: #f8f9ff; }\n        .result { margin-top: 15px; padding: 10px; border-radius: 4px; }\n        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }\n        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>{{.app_title}}</h1>\n        <div>\n            <span class=\"user-info\" id=\"userInfo\">Loading...</span>\n            <button class=\"logout-btn\" onclick=\"logout()\">Logout</button>\n        </div>\n    </div>\n\n    <!-- Step 1: Select Template -->\n    <div class=\"step active\" id=\"step1\">\n        <div class=\"step-header\">\n            <div class=\"step-number\">1</div>\n            <h2>Choose Email Template</h2>\n        </div>\n        <div class=\"form-group\">\n            <label for=\"template\">Template:</label>\n            <select id=\"template\">\n                <option value=\"\">Select template...</option>\n                {{range .email_templates}}\n                <option value=\"{{.id}}\">{{.name}}</option>\n                {{end}}\n            </select>\n        </div>\n        <div class=\"form-group\">\n            <label for=\"subject\">Subject:</label>\n            <input type=\"text\" id=\"subject\" placeholder=\"Email subject\">\n        </div>\n        <div class=\"form-group\">\n            <label for=\"content\">Content:</label>\n            <textarea id=\"content\" rows=\"6\" placeholder=\"Email content...\"></textarea>\n        </div>\n        <button onclick=\"nextStep(1)\">Next: Select Recipients</button>\n        <div id=\"step1-result\" class=\"result\" style=\"display: none;\"></div>\n    </div>\n\n    <!-- Step 2: Select Recipients -->\n    <div class=\"step\" id=\"step2\">\n        <div class=\"step-header\">\n            <div class=\"step-number\">2</div>\n            <h2>Choose Recipients</h2>\n        </div>\n        <div class=\"form-group\">\n            <label for=\"recipientList\">Recipient List:</label>\n            <select id=\"recipientList\">\n                <option value=\"\">Select list...</option>\n                {{range .recipient_lists}}\n                <option value=\"{{.id}}\">{{.name}} ({{len .contacts}} contacts)</option>\n                {{end}}\n            </select>\n        </div>\n        <div class=\"form-group\">\n            <label for=\"customRecipients\">Or enter custom recipients (comma-separated):</label>\n            <textarea id=\"customRecipients\" rows=\"3\" placeholder=\"email1@example.com, email2@example.com\"></textarea>\n        </div>\n        <button onclick=\"previousStep(2)\">Previous</button>\n        <button onclick=\"nextStep(2)\">Next: Choose Provider</button>\n        <div id=\"step2-result\" class=\"result\" style=\"display: none;\"></div>\n    </div>\n\n    <!-- Step 3: Select Provider and Send -->\n    <div class=\"step\" id=\"step3\">\n        <div class=\"step-header\">\n            <div class=\"step-number\">3</div>\n            <h2>Choose Email Provider & Send</h2>\n        </div>\n        <div id=\"providerOptions\">\n            {{range .email_providers}}\n            <div class=\"provider-option\" onclick=\"selectProvider('{{.id}}')\"> \n                <div>\n                    <h3>{{.name}}</h3>\n                    <p>Cost: ${{.cost_per_email}} per email | Daily limit: {{.limits.daily}}</p>\n                    <p>Features: {{range .features}}{{.}}, {{end}}</p>\n                </div>\n            </div>\n            {{end}}\n        </div>\n        <button onclick=\"previousStep(3)\">Previous</button>\n        <button class=\"send\" onclick=\"sendCampaign()\" id=\"sendButton\">üìß Send Campaign</button>\n        <div id=\"step3-result\" class=\"result\" style=\"display: none;\"></div>\n    </div>\n\n    <script>\n        let currentStep = 1;\n        let selectedProvider = '';\n        let campaignData = {};\n        let authToken = sessionStorage.getItem('authToken');\n        let user = JSON.parse(sessionStorage.getItem('user') || '{}');\n\n        window.onload = function() {\n            if (!authToken) {\n                window.location.href = '/login';\n                return;\n            }\n            document.getElementById('userInfo').textContent = 'Logged in as: ' + user.username + ' (' + user.role + ')';\n        };\n\n        function nextStep(step) {\n            if (step === 1) {\n                const template = document.getElementById('template').value;\n                const subject = document.getElementById('subject').value;\n                const content = document.getElementById('content').value;\n                if (!subject || !content) {\n                    showResult('step1-result', 'error', '‚ùå Please fill in subject and content');\n                    return;\n                }\n                campaignData.template = template;\n                campaignData.subject = subject;\n                campaignData.content = content;\n                showStep(2);\n            } else if (step === 2) {\n                const recipientList = document.getElementById('recipientList').value;\n                const customRecipients = document.getElementById('customRecipients').value;\n                if (!recipientList && !customRecipients) {\n                    showResult('step2-result', 'error', '‚ùå Please select a list or enter custom recipients');\n                    return;\n                }\n                campaignData.recipientList = recipientList;\n                campaignData.customRecipients = customRecipients;\n                showStep(3);\n            }\n        }\n\n        function previousStep(step) {\n            showStep(step - 1);\n        }\n\n        function showStep(stepNum) {\n            document.querySelectorAll('.step').forEach(step => {\n                step.classList.remove('active');\n                step.style.display = 'none';\n            });\n            document.getElementById('step' + stepNum).classList.add('active');\n            document.getElementById('step' + stepNum).style.display = 'block';\n            currentStep = stepNum;\n        }\n\n        function selectProvider(provider) {\n            selectedProvider = provider;\n            document.querySelectorAll('.provider-option').forEach(option => {\n                option.classList.remove('selected');\n            });\n            event.currentTarget.classList.add('selected');\n        }\n\n        async function sendCampaign() {\n            if (!selectedProvider) {\n                showResult('step3-result', 'error', '‚ùå Please select a provider');\n                return;\n            }\n\n            campaignData.provider = selectedProvider;\n\n            try {\n                const response = await fetch('/api/campaigns/send', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'Authorization': 'Bearer ' + authToken\n                    },\n                    body: JSON.stringify(campaignData)\n                });\n\n                const result = await response.json();\n                if (result.success) {\n                    showResult('step3-result', 'success',\n                        '‚úÖ Campaign sent successfully!<br>' +\n                        'Campaign ID: ' + result.campaign_id + '<br>' +\n                        'Emails sent: ' + result.emails_sent\n                    );\n                } else {\n                    showResult('step3-result', 'error', '‚ùå ' + result.error);\n                }\n            } catch (error) {\n                showResult('step3-result', 'error', '‚ùå ' + error.message);\n            }\n        }\n\n        function showResult(elementId, type, message) {\n            const element = document.getElementById(elementId);\n            element.className = 'result ' + type;\n            element.innerHTML = message;\n            element.style.display = 'block';\n        }\n\n        function logout() {\n            sessionStorage.removeItem('authToken');\n            sessionStorage.removeItem('user');\n            window.location.href = '/login';\n        }\n\n        // Initialize steps display\n        showStep(1);\n    </script>\n</body>\n</html>"
        },
        "home_page": {
            "type": "html",
            "template": "<!DOCTYPE html>\n<html>\n<head>\n    <title>{{.app_title}}</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }\n        .hero { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; margin-bottom: 30px; }\n        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }\n        .feature { padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }\n        .cta { text-align: center; }\n        .btn { display: inline-block; padding: 12px 24px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; margin: 10px; }\n        .btn:hover { background: #0056b3; }\n    </style>\n</head>\n<body>\n    <div class=\"hero\">\n        <h1>{{.app_title}}</h1>\n        <p>Complete email campaign system built entirely from JSON configuration</p>\n        <p><strong>Version:</strong> {{.version}} | <strong>Engine:</strong> JSON-Driven Workflow</p>\n    </div>\n\n    <div class=\"features\">\n        <div class=\"feature\">\n            <h3>üìß Campaign Management</h3>\n            <p>Create and send email campaigns with templates</p>\n        </div>\n        <div class=\"feature\">\n            <h3>üë• Recipient Lists</h3>\n            <p>Manage contact lists and segmentation</p>\n        </div>\n        <div class=\"feature\">\n            <h3>üîÑ Multi-Provider</h3>\n            <p>Support for multiple email service providers</p>\n        </div>\n        <div class=\"feature\">\n            <h3>üìä Analytics</h3>\n            <p>Track delivery rates and campaign performance</p>\n        </div>\n        <div class=\"feature\">\n            <h3>üé® Templates</h3>\n            <p>Pre-built email templates with customization</p>\n        </div>\n        <div class=\"feature\">\n            <h3>üîß JSON-Driven</h3>\n            <p>Entire application defined in JSON configuration</p>\n        </div>\n    </div>\n\n    <div class=\"cta\">\n        <h2>Get Started</h2>\n        <a href=\"/login\" class=\"btn\">üîê Login to Campaign Manager</a>\n        <a href=\"/docs\" class=\"btn\">üìñ View Documentation</a>\n    </div>\n</body>\n</html>"
        }
    },
    "functions": {
        "authenticate_user": {
            "id": "authenticate_user",
            "name": "User Authentication",
            "type": "builtin",
            "handler": "authenticate"
        },
        "send_email_campaign": {
            "id": "send_email_campaign",
            "name": "Send Email Campaign",
            "type": "custom",
            "config": {
                "action": "send_campaign",
                "entity": "email"
            }
        },
        "get_templates": {
            "id": "get_templates",
            "name": "Get Email Templates",
            "type": "expression",
            "response": {
                "templates": "{{.email_templates}}"
            }
        },
        "get_recipients": {
            "id": "get_recipients",
            "name": "Get Recipient Lists",
            "type": "expression",
            "response": {
                "lists": "{{.recipient_lists}}"
            }
        }
    },
    "validators": {
        "email_validator": {
            "id": "email_validator",
            "type": "custom",
            "rules": {
                "subject": { "required": true, "minLength": 5 },
                "content": { "required": true, "minLength": 10 },
                "recipients": { "required": true, "type": "array", "minItems": 1 }
            }
        }
    },
    "routes": [
        {
            "path": "/",
            "method": "GET",
            "handler": {
                "type": "template",
                "target": "home_page"
            }
        },
        {
            "path": "/login",
            "method": "GET",
            "handler": {
                "type": "template",
                "target": "login_page"
            }
        },
        {
            "path": "/auth/login",
            "method": "POST",
            "handler": {
                "type": "function",
                "target": "authenticate_user"
            }
        },
        {
            "path": "/campaigns",
            "method": "GET",
            "handler": {
                "type": "template",
                "target": "campaign_dashboard"
            },
            "auth": {
                "required": true,
                "redirect": "/login"
            }
        },
        {
            "path": "/api/campaigns/send",
            "method": "POST",
            "handler": {
                "type": "function",
                "target": "send_email_campaign"
            },
            "auth": {
                "required": true
            }
        },
        {
            "path": "/api/templates",
            "method": "GET",
            "handler": {
                "type": "function",
                "target": "get_templates"
            },
            "auth": {
                "required": true
            }
        },
        {
            "path": "/api/recipients",
            "method": "GET",
            "handler": {
                "type": "function",
                "target": "get_recipients"
            },
            "auth": {
                "required": true
            }
        }
    ],
    "workflows": [
        {
            "id": "email_campaign_workflow",
            "name": "Email Campaign Workflow",
            "description": "Process for sending email campaigns",
            "nodes": [
                {
                    "id": "validate_campaign",
                    "type": "function",
                    "name": "Validate Campaign Data",
                    "function": "email_validator"
                },
                {
                    "id": "prepare_recipients",
                    "type": "function",
                    "name": "Prepare Recipient List",
                    "function": "get_recipients"
                },
                {
                    "id": "send_emails",
                    "type": "function",
                    "name": "Send Email Campaign",
                    "function": "send_email_campaign"
                }
            ],
            "edges": [
                {
                    "id": "edge1",
                    "from": "validate_campaign",
                    "to": "prepare_recipients"
                },
                {
                    "id": "edge2",
                    "from": "prepare_recipients",
                    "to": "send_emails"
                }
            ]
        }
    ]
}
